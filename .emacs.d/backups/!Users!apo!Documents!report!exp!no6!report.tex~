% Intended LaTeX compiler: pdflatex
\documentclass[a4paper,titlepage]{jsarticle}
                                \usepackage{caption}
                \usepackage{url}
                \usepackage[dvipdfmx]{graphicx}

\usepackage{listings}
\lstset{  basicstyle={\ttfamily},  identifierstyle={\small},  commentstyle={\smallitshape},  keywordstyle={\small\bfseries},  ndkeywordstyle={\small},  stringstyle={\small\ttfamily},  frame={tb},  breaklines=true,  columns=[l]{fullflexible},  numbers=left,  xrightmargin=0zw,  xleftmargin=3zw,  numberstyle={\scriptsize},  stepnumber=1,  numbersep=1zw,  lineskip=-0.5ex}
\author{小高 拓海}
\date{\today}
\title{実験6}
\begin{document}

\maketitle

\section{目的}
\label{sec:orga1a6779}
電磁気学に関する数値計算及び測定装置の制御を題材として、LabVIEWの扱い方を学ぶとともに、理論式から数値計算を行うための手段や計測法について理解を深めることを目的とする。

\section{基礎知識}
\label{sec:org6ff97a7}
\subsection{ビオ・サバールの法則}
\label{sec:org889423f}
ビオ・サバールの法則とは、有限長の直流電流が任意の場所に発生させる磁束密度に関する法則で、透磁率\(\mu\) の空間中において、電流I が流れる\(\Delta\) I の部分がrだけ離れた点Pに作る磁束密度の大きさ\(\Delta\) Bは
\begin{equation}
\Delta B = \frac{\mu}{4\pi}\frac{I}{r^2}\Delta I \sin{(\theta)}
\end{equation}
で与えられる。ただし、\(\theta\) は電流の方向と点Pとの間の角度を示す。

\subsection{単線に電流を通電した場合に発生する磁束密度}
\label{sec:orgd1f2b9c}
ビオ・サバールの法則を用いて計算する方法として、L[m]の有限長導体に電流I[A]が流れているとき、有限長導体からa[m]の点Pに発生する磁束密度の大きさB[T]は
\begin{eqnarray}
B & = & \frac{\mu_0 I}{4\pi a}(\sin{(\psi 2)}-\sin{(\psi 1)}) \nonumber \\
& = & \frac{\mu_0 I}{4\pi a}(\cos{(\theta 2)}-\cos{(\theta 1)})
\end{eqnarray}
として表すことができる。この数式を応用することで、様々な形状の電流に夜磁束密度の計測を行うことが可能である。無限長の場合、
\begin{equation}
B = \frac{\mu I}{2\pi a}
\end{equation}
となる。

\subsection{\ref{sec:orgd1f2b9c}における磁束密度分布}
\label{sec:orgfdf481b}
\ref{sec:orgd1f2b9c}で計算した値は円周方向の値であるが、それを直線上に計測した場合、磁束密度Bは図\ref{fig:org34753dc}のようにx・yの２方向に分けて考えることができる。

\begin{figure}[htbp]
\centering
\includegraphics[width=6cm]{./img/mfb.jpg}
\caption{\label{fig:org34753dc}
単線電流と磁束密度}
\end{figure}

\subsection{ホール素子}
\label{sec:orgb64217a}
ホール素子とは、ホール効果を利用した半導体素子であり、磁束密度の計測に用いられる。ホール素子の出力電圧は、ホール素子に対して垂直方向に印加される磁束密度の大きさと通電電流に比例する。

このことから、2.3で考えた磁束密度分布のうち、ホール素子で計測できるのはy方向のものである。それは
\begin{equation}
B_y = B\cos{(\theta)} = \frac{\mu_0 Ix}{2\pi(x^2 + y^2)}
\end{equation}
で表される。

\subsection{LabVIEW}
\label{sec:org6cb4e85}
LabVIEWはNational Instrumentsが開発した計測制御などを目的としたソフトウェアで、GUIを備えたアプリケーションの作成が容易であり、アプリケーションの動作もアイコン等を配線で結ぶことで記述できるため、初期の学習コストが低い。

LabVIEWはフロントパネルとブロックダイアグラムの２画面で構成され、プログラムの内部構造をブロックダイアグラムに、操作GUIをフロントパネルにそれぞれ記述する。

\section{使用機器}
\label{sec:org934e032}
本実験における使用機器を表\ref{tab:org80f39ea}に示す。

\begin{table}[htbp]
\caption{\label{tab:org80f39ea}
使用機器}
\centering
\begin{tabular}{|c|c|c|c|}
\hline
機器名 & メーカー名 & 型番 & シリアルNo.\\
\hline
PC & - & - & -\\
I/Oインターフェース & National Instruments & USB-6008 & -\\
抵抗・LED等回路素子 & - & - & -\\
ブレッドボード・配線 & - & - & -\\
\hline
\end{tabular}
\end{table}

\section{実験方法}
\label{sec:org464ebb8}
\subsection{LabVIEWを用いた基本的な制御プログラムの作成}
\label{sec:orgff3f090}
数値計算やグラフ化、デジタル・アナログの入出力など、LabBVIEWを用いて制御を行うために必要となる各要素について、動作仕様の確認を目的としたプログラムを作成する。具体的に作成したものは以下の通りである。

\begin{enumerate}
\item 減算
\item 論理積否定
\item whileループ
\item forループ
\item グラフ生成
\item デジタル出力
\item デジタル入力
\item アナログ出力
\item アナログ入力
\end{enumerate}

\subsection{磁束密度計算}
\label{sec:org742dce7}
LabVIEWを用いて
\begin{itemize}
\item 単線に電流を通電させた場合に発生する磁束密度の計算プログラム
\item 半径を持つ導線に電流を通電させた場合に発生する磁束密度の計算プログラム
\end{itemize}
を作成する。

\subsection{LabVIEWを用いた簡易計測システムにおける擬似的な実装}
\label{sec:org0a323a7}

簡易計測システムを構成する要素について、制御を行うためのプログラムを擬似的に実装する。担当部分はホール素子を移動させるためのステッピングモータの制御機構である。

\section{結果}
\label{sec:org0e93e70}
\subsection{LabVIEWを用いた基本的な制御プログラムの作成}
\label{sec:org37dd96e}
以下の項目について作成したプログラムのスクリーンショットを図\ref{org85085dc}〜図\ref{org0379842}に示す。

\begin{enumerate}
\item 減算
\item 論理積否定
\item whileループ
\item forループ
\item グラフ生成
\item デジタル出力
\item デジタル入力
\item アナログ出力
\item アナログ入力
\end{enumerate}

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/sub_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/sub_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org85085dc}
減算}
\end{figure}


\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/nand_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/nand_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org2e7effb}
論理積否定}
\end{figure}


\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/while_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/while_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{orgcd039b6}
whileループ - ループ回数が11の倍数のときにLED点灯}
\end{figure}

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/for_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/for_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org4a07891}
forループ - ループ回数が7で割ったときに3になる値のときにLED点灯}
\end{figure}

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/graph_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/graph_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{orgc6ece19}
グラフ生成 - 乱数生成器の情報をグラフ出力}
\end{figure}

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_out_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_out_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org87a0da2}
デジタル出力}
\end{figure}

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_in_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_in_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org144f87f}
デジタル入力}
\end{figure}

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_out_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_out_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org6fc182e}
アナログ出力}
\end{figure}

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_in_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_in_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org0379842}
アナログ入力}
\end{figure}

\subsection{磁束密度計算}
\label{sec:orgf80cbd5}
\subsubsection{単線に電流を通電させた場合に発生する磁束密度}
\label{sec:orgd8d8de7}
単線に電流を通電させた場合に発生する磁束密度の計算プログラムを作成した。作成したプログラムのスクリーンショットを図\ref{orgf1f022d}に示す。

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no1_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no1_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{orgf1f022d}
単線に電流を通電させた場合に発生する磁束密度 - 計算式はMathscriptノードを用いて処理を行った}
\end{figure}

\subsubsection{半径を持つ導線に電流を通電させた場合に発生する磁束密度}
\label{sec:orgaabd975}
半径を持つ導線に電流を通電させた場合に発生する磁束密度の計算プログラムを作成した。作成したプログラムのスクリーンショットを図\ref{org660b961}に示す。

\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no2_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no2_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org660b961}
半径を持つ導線に電流を通電させた場合に発生する磁束密度 - 計算式はMathscriptノードを用いて処理を行った}
\end{figure}

\subsection{LabVIEWを用いた簡易計測システムにおける擬似的な実装}
\label{sec:orga5efe94}
今回の自分の担当部分であるステッピングモータの制御機構を擬似的に実装した。モータへの信号出力をデジタル出力で行い、動作確認はLEDの点灯で行った。作成したプログラムのスクリーンショットを図\ref{org64cb4ec}に示す。
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/stepping_motor_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/stepping_motor_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\caption{\label{org64cb4ec}
ステッピングモータの制御プログラム - 移動目標距離、最小移動単位を入力として移動に必要なパルス数を求め、待機時間を適切に管理する。}
\end{figure}

\section{考察・課題}
\label{sec:orgf9f2071}
\subsection{LabVIEWを用いたプログラミングについて}
\label{sec:org5aaad81}
LabVIEWは、ハードウェアの制御によく用いられるツールであるため、似たような用途でよく用いられるC++と比較をする(C++はArduinoの制御の際に用いられる)。

\subsubsection{学習コスト}
\label{sec:org3218ecc}
LabVIEWは前述の通り、アイコンや線でグラフィカルにプログラムが作成できるため、操作方法が直感的であるため、初学者でもアルゴリズムさえ考えることができれば比較的下記始めやすい。

一方でC++は、アルゴリズムを考えることができたとしても、標準入力の方法やコーディング規則など、実装以外の部分での制約に気を配る必要があるため、初期の学習コストは重い。その一方で、C++を用いて同様の実験を行った人が共有してくれている公式以外のリファレンスは豊富であるため、情報収集を適切に行えれば習得スピードは向上する。

\subsubsection{アルゴリズム構築の難易度}
\label{sec:orgd09ad42}
今回使用してきた中で、LabVIEWは主に１ループ内の実行順序やスコープの内外での変数の型など、ひと目で動作が保証できない場面が多々あった。一応の原則として左から右、上から下という実行順序は決まっているものの、アイコンの大きさや位置関係などによって、どちらが先に動作するのか不明瞭になりがちである。その結果、「試しに一度実行してみよう」という検証工程を挟まなければならなくなり、手間がかかる。

それに対しC++は基本的には手続き型の逐次処理であるため、上から下への動作順の保証がされており、スコープの明示がコーディング規則で定められているため、全体の見通しが立てやすい。それにより、考えたアルゴリズムをそのまま実装するという点においてはLabVIEWに比べ優位性があると考える。

\subsubsection{可読性}
\label{sec:orgf59f733}
LabVIEWを用いて複雑なプログラムを作成すると、どうしても配線が混線してしまい、どの命令アイコンにどの値が代入されているのかなどがひと目で確認することができなくなる。サブVI化することでいくらかの混線は避けることができるが、入出力周辺はやはり混線しがちである。

それに対し、C++は関数化やクラス化などを用いて全体の構成をわかりやすい形に再構築が可能であり、全てがテキストベースであるためコメントアウトが示す先もわかりやすい。

\subsection{正n角形の中心における磁束密度計算プログラム}
\label{sec:orgc66d652}
電流が流れる単線を、n角形に配置した際の中心点における磁束密度を算出するプログラムをGUIつきのプログラムで作成する。今回は動作環境に依存せず、なるべくわかりやすい形で実装することを考え、Javascriptを用いてブラウザベースで動作するものを作成した。スクリーンショットを図\ref{fig:orgd9808ca}に、ソースコードをListing 1に示す

\begin{figure}[htbp]
\centering
\includegraphics[width=5cm]{./img/screenshot.png}
\caption{\label{fig:orgd9808ca}
作成したプログラムのGUI}
\end{figure}

\newpage

\begin{lstlisting}[caption=磁束密度計算ツール,label=list]

<html>
  <head>
    <meta charset="UTF-8">
    <title>課題</title>

    <script type="text/javascript" language="javascript">
      function onButtonClick() {
      var a = parseFloat(document.form1.textBox1.value);
      var n = parseFloat(document.form1.textBox2.value);
      var I = parseFloat(document.form1.textBox3.value);

      var T = 100*((Math.tan(Math.PI/n) * (I*2*n)) / a);

      document.form1.textBox4.value = T;

      }
    </script>
  </head>

  <body>
    <form name="form1">
      半径a[mm]<br>
      <input name="textBox1" type="text" value="" /><br>
      角数n<br>
      <input name="textBox2" type="text" value="" /><br>
      電流I[A]<br>
      <input name="textBox3" type="text" value="" /><br>
      <input type="button" value="Calc" onclick="onButtonClick();" />
      <hr/>
      磁束密度[uT]<br>
      <input name="textBox4" type="text" /><br>
    </form>
  </body>
</html>

\end{lstlisting}
\end{document}
