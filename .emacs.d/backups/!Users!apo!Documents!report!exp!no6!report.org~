#+TITLE: 実験6
#+AUTHOR: 小高 拓海
#+LATEX_CLASS: jsarticle
#+OPTIONS: toc:nil timestamp:nil
#+LATEX_HEADER: \usepackage{listings}
#+LATEX_HEADER: \lstset{  basicstyle={\ttfamily},  identifierstyle={\small},  commentstyle={\smallitshape},  keywordstyle={\small\bfseries},  ndkeywordstyle={\small},  stringstyle={\small\ttfamily},  frame={tb},  breaklines=true,  columns=[l]{fullflexible},  numbers=left,  xrightmargin=0zw,  xleftmargin=3zw,  numberstyle={\scriptsize},  stepnumber=1,  numbersep=1zw,  lineskip=-0.5ex}

* 目的
電磁気学に関する数値計算及び測定装置の制御を題材として、LabVIEWの扱い方を学ぶとともに、理論式から数値計算を行うための手段や計測法について理解を深めることを目的とする。

* 基礎知識
** ビオ・サバールの法則
ビオ・サバールの法則とは、有限長の直流電流が任意の場所に発生させる磁束密度に関する法則で、透磁率\mu の空間中において、電流I が流れる\Delta I の部分がrだけ離れた点Pに作る磁束密度の大きさ\Delta Bは
\begin{equation}
\Delta B = \frac{\mu}{4\pi}\frac{I}{r^2}\Delta I \sin{(\theta)}
\end{equation}
で与えられる。ただし、\theta は電流の方向と点Pとの間の角度を示す。

** 単線に電流を通電した場合に発生する磁束密度
ビオ・サバールの法則を用いて計算する方法として、L[m]の有限長導体に電流I[A]が流れているとき、有限長導体からa[m]の点Pに発生する磁束密度の大きさB[T]は
\begin{eqnarray}
B & = & \frac{\mu_0 I}{4\pi a}(\sin{(\psi 2)}-\sin{(\psi 1)}) \nonumber \\
& = & \frac{\mu_0 I}{4\pi a}(\cos{(\theta 2)}-\cos{(\theta 1)})
\end{eqnarray}
として表すことができる。この数式を応用することで、様々な形状の電流に夜磁束密度の計測を行うことが可能である。無限長の場合、
\begin{equation}
B = \frac{\mu I}{2\pi a}
\end{equation}
となる。

** [[単線に電流を通電した場合に発生する磁束密度]]における磁束密度分布
[[単線に電流を通電した場合に発生する磁束密度]]で計算した値は円周方向の値であるが、それを直線上に計測した場合、磁束密度Bは図[[fig:mfd]]のようにx・yの２方向に分けて考えることができる。

#+CAPTION: 単線電流と磁束密度
#+NAME: fig:mfd
#+ATTR_LaTeX: :width 6cm
[[./img/mfb.jpg]]

** ホール素子
ホール素子とは、ホール効果を利用した半導体素子であり、磁束密度の計測に用いられる。ホール素子の出力電圧は、ホール素子に対して垂直方向に印加される磁束密度の大きさと通電電流に比例する。

このことから、2.3で考えた磁束密度分布のうち、ホール素子で計測できるのはy方向のものである。それは
\begin{equation}
B_y = B\cos{(\theta)} = \frac{\mu_0 Ix}{2\pi(x^2 + y^2)}
\end{equation}
で表される。

** LabVIEW
LabVIEWはNational Instrumentsが開発した計測制御などを目的としたソフトウェアで、GUIを備えたアプリケーションの作成が容易であり、アプリケーションの動作もアイコン等を配線で結ぶことで記述できるため、初期の学習コストが低い。

LabVIEWはフロントパネルとブロックダイアグラムの２画面で構成され、プログラムの内部構造をブロックダイアグラムに、操作GUIをフロントパネルにそれぞれ記述する。

* 使用機器
本実験における使用機器を表[[tb:use]]に示す。

#+CAPTION: 使用機器
#+NAME: tb:use
#+ATTR_LaTeX: :align |c|c|c|c|
|----------------------+----------------------+----------+-------------|
| 機器名               | メーカー名           | 型番     | シリアルNo. |
|----------------------+----------------------+----------+-------------|
| PC                   | -                    | -        | -           |
| I/Oインターフェース  | National Instruments | USB-6008 | -           |
| 抵抗・LED等回路素子  | -                    | -        | -           |
| ブレッドボード・配線 | -                    | -        | -           |
|----------------------+----------------------+----------+-------------|

* 実験方法
** LabVIEWを用いた基本的な制御プログラムの作成
数値計算やグラフ化、デジタル・アナログの入出力など、LabBVIEWを用いて制御を行うために必要となる各要素について、動作仕様の確認を目的としたプログラムを作成する。具体的に作成したものは以下の通りである。

1. 減算
2. 論理積否定
3. whileループ
4. forループ
5. グラフ生成
6. デジタル出力
7. デジタル入力
8. アナログ出力
9. アナログ入力

** 磁束密度計算
LabVIEWを用いて
+ 単線に電流を通電させた場合に発生する磁束密度の計算プログラム
+ 半径を持つ導線に電流を通電させた場合に発生する磁束密度の計算プログラム
を作成する。

** LabVIEWを用いた簡易計測システムにおける擬似的な実装

簡易計測システムを構成する要素について、制御を行うためのプログラムを擬似的に実装する。担当部分はホール素子を移動させるためのステッピングモータの制御機構である。

* 結果
** LabVIEWを用いた基本的な制御プログラムの作成
以下の項目について作成したプログラムのスクリーンショットを図[[fig:first]]〜図[[fig:ninth]]に示す。

1. 減算
2. 論理積否定
3. whileループ
4. forループ
5. グラフ生成
6. デジタル出力
7. デジタル入力
8. アナログ出力
9. アナログ入力

#+CAPTION: 減算
#+NAME: fig:first
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/sub_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/sub_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: 論理積否定
#+NAME: fig:second
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/nand_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/nand_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: whileループ - ループ回数が11の倍数のときにLED点灯
#+NAME: fig:third
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/while_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/while_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: forループ - ループ回数が7で割ったときに3になる値のときにLED点灯
#+NAME: fig:fourth
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/for_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/for_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: グラフ生成 - 乱数生成器の情報をグラフ出力
#+NAME: fig:fifth
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/graph_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/graph_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: デジタル出力
#+NAME: fig:sixth
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_out_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_out_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: デジタル入力
#+NAME: fig:seventh
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_in_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/digital_in_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: アナログ出力
#+NAME: fig:eighth
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_out_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_out_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

#+CAPTION: アナログ入力
#+NAME: fig:ninth
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_in_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/analog_in_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

** 磁束密度計算
*** 単線に電流を通電させた場合に発生する磁束密度
単線に電流を通電させた場合に発生する磁束密度の計算プログラムを作成した。作成したプログラムのスクリーンショットを図[[fig:no1]]に示す。

#+CAPTION: 単線に電流を通電させた場合に発生する磁束密度 - 計算式はMathscriptノードを用いて処理を行った
#+NAME: fig:no1
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no1_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no1_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

*** 半径を持つ導線に電流を通電させた場合に発生する磁束密度
半径を持つ導線に電流を通電させた場合に発生する磁束密度の計算プログラムを作成した。作成したプログラムのスクリーンショットを図[[fig:no2]]に示す。

#+CAPTION: 半径を持つ導線に電流を通電させた場合に発生する磁束密度 - 計算式はMathscriptノードを用いて処理を行った
#+NAME: fig:no2
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no2_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/no2_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

** LabVIEWを用いた簡易計測システムにおける擬似的な実装
今回の自分の担当部分であるステッピングモータの制御機構を擬似的に実装した。モータへの信号出力をデジタル出力で行い、動作確認はLEDの点灯で行った。作成したプログラムのスクリーンショットを図[[fig:stepping]]に示す。
#+CAPTION: ステッピングモータの制御プログラム - 移動目標距離、最小移動単位を入力として移動に必要なパルス数を求め、待機時間を適切に管理する。
#+NAME: fig:stepping
\begin{figure}[htbp]
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/stepping_motor_front.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{フロントパネル}
  \addtocounter{figure}{-1}
 \end{minipage}
 \begin{minipage}[t]{0.5\hsize}
  \begin{center}
   \includegraphics[width=70mm]{./img/stepping_motor_block.png}
  \end{center}
\captionsetup{labelformat=empty,labelsep=none}
  \caption{ブロックダイアグラム}
  \addtocounter{figure}{-1}
 \end{minipage}
\end{figure}

* 考察・課題
** LabVIEWを用いたプログラミングについて
LabVIEWは、ハードウェアの制御によく用いられるツールであるため、似たような用途でよく用いられるC++と比較をする(C++はArduinoの制御の際に用いられる)。

*** 学習コスト
LabVIEWは前述の通り、アイコンや線でグラフィカルにプログラムが作成できるため、操作方法が直感的であるため、初学者でもアルゴリズムさえ考えることができれば比較的下記始めやすい。

一方でC++は、アルゴリズムを考えることができたとしても、標準入力の方法やコーディング規則など、実装以外の部分での制約に気を配る必要があるため、初期の学習コストは重い。その一方で、C++を用いて同様の実験を行った人が共有してくれている公式以外のリファレンスは豊富であるため、情報収集を適切に行えれば習得スピードは向上する。

*** アルゴリズム構築の難易度
今回使用してきた中で、LabVIEWは主に１ループ内の実行順序やスコープの内外での変数の型など、ひと目で動作が保証できない場面が多々あった。一応の原則として左から右、上から下という実行順序は決まっているものの、アイコンの大きさや位置関係などによって、どちらが先に動作するのか不明瞭になりがちである。その結果、「試しに一度実行してみよう」という検証工程を挟まなければならなくなり、手間がかかる。

それに対しC++は基本的には手続き型の逐次処理であるため、上から下への動作順の保証がされており、スコープの明示がコーディング規則で定められているため、全体の見通しが立てやすい。それにより、考えたアルゴリズムをそのまま実装するという点においてはLabVIEWに比べ優位性があると考える。

*** 可読性
LabVIEWを用いて複雑なプログラムを作成すると、どうしても配線が混線してしまい、どの命令アイコンにどの値が代入されているのかなどがひと目で確認することができなくなる。サブVI化することでいくらかの混線は避けることができるが、入出力周辺はやはり混線しがちである。

それに対し、C++は関数化やクラス化などを用いて全体の構成をわかりやすい形に再構築が可能であり、全てがテキストベースであるためコメントアウトが示す先もわかりやすい。

** 正n角形の中心における磁束密度計算プログラム
電流が流れる単線を、n角形に配置した際の中心点における磁束密度を算出するプログラムをGUIつきのプログラムで作成する。今回は動作環境に依存せず、なるべくわかりやすい形で実装することを考え、Javascriptを用いてブラウザベースで動作するものを作成した。スクリーンショットを図[[fig:screenshot]]に、ソースコードをListing 1に示す

#+CAPTION: 作成したプログラムのGUI
#+NAME: fig:screenshot
#+ATTR_LaTeX: :width 5cm
[[./img/screenshot.png]]

\newpage

\begin{lstlisting}[caption=磁束密度計算ツール,label=list]

<html>
  <head>
    <meta charset="UTF-8">
    <title>課題</title>

    <script type="text/javascript" language="javascript">
      function onButtonClick() {
      var a = parseFloat(document.form1.textBox1.value);
      var n = parseFloat(document.form1.textBox2.value);
      var I = parseFloat(document.form1.textBox3.value);

      var T = 100*((Math.tan(Math.PI/n) * (I*2*n)) / a);

      document.form1.textBox4.value = T;

      }
    </script>
  </head>

  <body>
    <form name="form1">
      半径a[mm]<br>
      <input name="textBox1" type="text" value="" /><br>
      角数n<br>
      <input name="textBox2" type="text" value="" /><br>
      電流I[A]<br>
      <input name="textBox3" type="text" value="" /><br>
      <input type="button" value="Calc" onclick="onButtonClick();" />
      <hr/>
      磁束密度[uT]<br>
      <input name="textBox4" type="text" /><br>
    </form>
  </body>
</html>

\end{lstlisting}
