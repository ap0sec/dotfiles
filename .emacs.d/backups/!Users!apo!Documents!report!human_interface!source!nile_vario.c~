#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define DATA_LEN 633
#define TAU 1

void vario(double *data, double *out){
  int i, j;
  
  for(i=0; i<DATA_LEN; i++){
    for(j=0; j<DATA_LEN-i; j++){
      out[i] += pow((data[j]-data[j+i]),2.0);
    }
    out[i] /= (double)2;
  }
}

int main(void){
  int i, j;
  double *data, *out;
  FILE *fw, *fr;

  data = (double *)malloc(sizeof(double)*(DATA_LEN));
  out = (double *)malloc(sizeof(double)*(DATA_LEN));
  if(data==NULL || out==NULL){
    printf("data is not enougth memory.\n");
    exit(1);
  }

  for(i=0; i<DATA_LEN; i++){
    out[i] = 0;
  }
  
  fw = fopen("../csv/nile_balio.csv", "w");
  fr = fopen("../csv/nile.csv", "r");
  
  if(fw==NULL || fr == NULL){
    printf("con not open this file.\n");
    exit(1);
  }

  // make 1/0
  /*
  for(i=0; i<DATA_LEN; i++){
    data[i] = sin(i*0.1);
    printf("%lf ",data[i]);
    }*/

  // read data
  for(i=0; i<DATA_LEN; i++){
  fscanf(fr, "%lf,", &data[i]);
  printf("%lf\n",data[i]);
  }

  vario(data, out);
 
  for(i=0; i<DATA_LEN; i++){
    fprintf(fw, "%d,%lf\n", i, out[i]/out[0]);
  }

  free(data);
  free(out);
  fclose(fw);
  fclose(fr);
}
