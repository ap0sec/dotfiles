#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Prompt theme
autoload -Uz promptinit
promptinit
prompt pure

# History search
bindkey "^P" history-beginning-search-backward
bindkey "^N" history-beginning-search-forward

# Emacs aliases
alias ew="emacsclient -c"
alias et="emacsclient -nw"
alias ekill="emacsclient -e '(kill-emacs)'"
alias edaemon="emacs --daemon"

# "cd .."
function cdup() {
  echo
  cd ..
  prompt_$(prompt_theme)_precmd
  zle reset-prompt
  return 0
}
zle -N cdup

# direnv configure
eval "$(direnv hook zsh)"

# pyenv configure
eval "$(pyenv init -)"

# pipenv dir configure
export PIPENV_VENV_IN_PROJECT=.

# change AWS accounts
lsAWS() {
  cat ~/.aws/config | grep profile
}
showAWS() {
  echo Default account is \'$AWS_DEFAULT_PROFILE\'
  aws sts get-caller-identity
}
changeAWS() {
  export AWS_DEFAULT_PROFILE=$1
  echo Default account is changed \'$AWS_DEFAULT_PROFILE\'
}
alias clearAWS="unset AWS_DEFAULT_PROFILE"

# Convert Json -> YAML
json2yaml() {
  ruby -ryaml -rjson -e 'puts YAML.dump(JSON.parse(STDIN.read))'
}

# Rename serial num

mvall() {
  NAME=$1
  EXT=$2
  awk '{printf "mv \"%s\" xxx%01d.yyy\n", $0, NR}' | sed "s/xxx/$(echo $NAME)/g" | sed "s/yyy/$(echo $EXT)/g"
}

# The next line updates PATH for the Google Cloud SDK.
if [ -f "$(echo $HOME)/google-cloud-sdk/path.zsh.inc" ]; then . "$(echo $HOME)/google-cloud-sdk/path.zsh.inc"; fi

# The next line enables shell command completion for gcloud.
if [ -f "$(echo $HOME)/google-cloud-sdk/completion.zsh.inc" ]; then . "$(echo $HOME)/google-cloud-sdk/completion.zsh.inc"; fi

export NVM_DIR="$HOME/.nvm"
[ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm

[ -s "/usr/local/opt/nvm/etc/bash_completion.d/nvm" ] && . "/usr/local/opt/nvm/etc/bash_completion.d/nvm"  # This loads nvm bash_completion
